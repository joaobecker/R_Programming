---
title: "milestone_report"
author: "becker"
date: '2018-07-25'
output: html_document
---

```{r setup, include=FALSE}
load("wp_data1.RData")
load("upgraded_11.RData")
load("cust_can.RData")
library(dplyr)
library(tidyr)
library(ggplot2)
```


### What is Wishpond?

  Wishpond is an All-in-one Marketing Suite for Retailers and Brand. The suite includes social contest and promotions app that permits you to run unlimited vote contests, sweepstakes, and campaigns. It additionally supplies a number of alternative tools such as landing page creators, email marketing and marketing automation.

### The Problem?

  Wishpond has thousands of customers that use the platform regularly. However, not much has been done to understand its customers and their actions in the platform. Therefore, this capstone project through data analysis, will investigate the different categories customers belong to and their main actions. In addition, it will use machine learning to indentify where customers will fall on and provide Wishpond with substantial data to focus on more specifics subjects that may generate more revenue.

### The Data Set

  The dataset for this project was acquired from Woopra, a customer service analytics that was installed in the Wishpond platform to track its customers’ actions. The database contains a total of 14,417 observations and 21 variables. For better understanding of the database, we will go over 8 of the most important variables to understand Wishpond’s customer.

##### Plan Name – (plan_name)

  Plan name identifies which plan the customer currently belongs to. Customers on Wishpond can belong to 4 different plans, they are: the starter plan, which is the plan for people that are just testing the platform and for those who have cancelled their plan. Basic plan, is the cheapest plan with a maximum amount of 1000 leads. Pro, is the intermediate plan, and it offers a maximum of 2500 leads. Growth plan offers unlimited leads. 

#####	Business Industry – (business_industry)

  Business industry identifies which industry customers belong to such as e-commerce, B2B, spa, fitness and others.

#####	Affiliated – (affiliated)

  Affiliated variable shows us if the customer has signed-up on Wishpond via an affiliated link or not. 

##### Sales – (sales)

  Sales variable shows us if the customer has signed-up on Wishpond after a demo with one of the sales agent at Wishpond. 

##### Read the blog – (read_blog)

  The read the blog variable identify those who have visited the Wishpond blog at one point in time. Wishpond blog is mostly about case-studies and content on lead generation 
techniques. 

##### Total Leads – (total_leads)

  Total leads represent the total amount of leads that the customer has acquired through Wishpond landing page or contest.

##### Total tools – (total_live_tools)

  Total tools represent the total amount of live tools, such as contests, pop-ups, workflows, forms and landing pages, that customers have under their account.

##### Unsubscribed – (Unsubscribed)

Unsubscribed identifies if a customer has unsubscribed from Wishpond or not.

### Data Limitation

  The limitation of the database is the large amount of missing data. The plan name variable is missing a third of its data, and other variables have an even larger number of missing data. In addition, a large amount of data from customers that have unsubscribed is lost, as Wishpond reset to zero the total leads and total tools they had under their account. Therefore, making it harder to determine if tools creation and amount of leads plays a role on their subscription.

### Data Wrangling

#### First Part

  The main database is formed by three different tables. These tables are: wp_data, upgrade_1 and cust_can. The wp_data and upgrade_1 tables have the same variables, the difference between them is that upgrade_1 has more information about customers that have upgraded to a paid account, while wp_data is more focused on clients that have assigned the type of industry they belong to. Lastly the cust_can table represents all the customer that have unsubscribed from Wishpond. Below shows the code of how these tables were combined into one.
  First we transformed the factor variables from the three tables into characters in order to not lose any information when comparing the variables from different tables.

```{r, echo=FALSE}
upgraded_1 <- upgraded_11
wp_data <- wp_data1
```

```{r}
#Transforming variables into characters to be able to use join function
wp_data[c(1:6, 12:16, 19)] <- lapply(wp_data[c(1:6, 12:16, 19)], as.character)
upgraded_1[c(1:6, 12:16, 19)] <- lapply(upgraded_1[c(1:6, 12:16, 19)], as.character)
cust_can$pid <- as.character(cust_can$pid)
```

	Second, we run the anti_join function to remove any duplicates from the upgrade_1 table and then we add the table to the wp_data with bind_rows function.

```{r}
# Here, we used anti_join to avoid having duplicates.
upgraded_1 <- anti_join(upgraded_1, wp_data, by = "pid")

#Combining Rows from different tables
wp_data <- bind_rows(wp_data, upgraded_1)
```

	Third, to know all the customers from the database that have unsubscribed, it was used the left_join function. Therefore, maintaining all the observations on wp_data while adding a new column, Unsubscribed. 

```{r}
# Using left_join to maintain all the current data from "wp_data" while adding a new column, Unsubscribed, from "cust_can"
wp_data <- left_join(wp_data, cust_can, by = c("pid" = "pid"))
```

  Lastly, during the join, empty columns were added. Thus, we get rid off with the code below.
```{r}
# Get rid off unwanted columns
wp_data <- wp_data[, -c(22:34)]

```

#### Second Part

  The database contained a lot of missing data, which made it difficult to read it. Therefore, empty values and NAs were replaced in order to create a more meaningful database. 


  For the missing data and NAs value on business industry, it was assigned the value “Unknown” 
```{r}
wp_data$business_industry <- gsub("^$", "Unknown", wp_data$business_industry)
wp_data <- wp_data %>%  replace_na(list(business_industry = "Unknown"))
```

  For the missing data on selected_service, it was assigned the value “Unknown” 
```{r}
wp_data$selected_service <- gsub("^$", "Unknown", wp_data$selected_service)
```

  For all the missing and null data on business_size, it was assigned the value “Unknown”
```{r}
wp_data$business_size[wp_data$business_size == "null"] <- "Unknown"
wp_data$business_size <- gsub("^$", "Unknown", wp_data$business_size)
```

  For the missing data on cancel_contact_support, it was assigned the value “No”, as only if a customer that has contacted support received a value of "Yes"
```{r}
wp_data$current_cancel_contact_support <- gsub("^$", "No", wp_data$current_cancel_contact_support)
```

  For the missing data on current_cancel_feeling, it was assigned the value “Unknown”
```{r}
wp_data$current_cancel_feeling <- gsub("^$", "Unknown", wp_data$current_cancel_feeling)
```

  For the missing data on has_seen_the_blog_overlay, it was assigned the value “FALSE” as all customers that have read the blog receveid the "TRUE" value
```{r}
wp_data <- wp_data %>%  replace_na(list(has_seen_the_blog_overlay = "FALSE"))
```

  For the missing data on support_agent_name, it was assigned the value “Unknown”
```{r}
wp_data$support_agent_name <- gsub("^$", "Unknown", wp_data$support_agent_name)
```

  For the missing data on locale, it was assigned the value “Unknown”
```{r}
wp_data$locale <- gsub("^$", "Unknown", wp_data$locale)
```

  For the missing data on plan_name, it was assigned the value “Unknown”
```{r}
wp_data$plan_name <- gsub("^$", "Unknown", wp_data$plan_name)
```

  For the missing data on sales_agent, it was assigned the value “Unknown”
```{r}
wp_data$sales_agent <- gsub("^$", "Unknown", wp_data$sales_agent)
```


  For the missing data on interest, it was assigned the value “Unknown”
```{r}
wp_data$interest <- gsub("^$", "Unknown", wp_data$interest)
```

  For the missing data on sales, it was assigned the value “FALSE” as all customers that have subscribed after a demo receveid the "TRUE" value
```{r}
wp_data <- wp_data %>%  replace_na(list(sales = "FALSE"))
```

  For the missing data on affiliated, it was assigned the value “FALSE” as all customers that have subscribed after coming thorugh an affiliated link receveid the "TRUE" value
```{r}
wp_data <- wp_data %>%  replace_na(list(affiliated = "FALSE"))
```

  For the missing data on Unsubscribed, it was assigned the value “FALSE” as all customers that have unsubscribed from Wishpond receveid the "TRUE" value
```{r}
wp_data <- wp_data %>% replace_na(list(Unsubscribed = "FALSE"))
```

#### Third Part	
  
  Some variables had a lot of different levels that could be represented by a unique level. Thus, the levels of these variables were summarized by using the code below:
	
  All the values containing a website will be replace with the "TRUE" value, while assigning "FALSE" to the empty rows
```{r}
wp_data$website[wp_data$website != ""] <- "TRUE"
wp_data$website[wp_data$website != "TRUE"] <- "FALSE"
```

  It will be assigned the "Self Service" value to all the rows containing "self" and "Fully Managed" to all the rows containing "fully"
```{r}
wp_data$selected_service <- gsub(".*self.*", "Self Service", wp_data$selected_service)
wp_data$selected_service <- gsub(".*fully.*", "Fully Managed", wp_data$selected_service)
```

  Some plans at Wishpond have a name added to the plan they upgraded to if a special discount was given. Therefore, in order to simplify the variable, it was assigned "Basic" to all the rows containing "Basic", and "Growth Plan" to all the rows containing "Growth"
```{r}
str(wp_data$plan_name)
wp_data$plan_name <- as.factor(wp_data$plan_name)
levels(wp_data$plan_name)
wp_data$plan_name <- gsub(".*Basic.*", "Basic", wp_data$plan_name)
wp_data$plan_name <- gsub(".*Growth.*", "Growth Plan", wp_data$plan_name)
```
  
  When customers subscribe to Wishpond, they get to write the why they decide to subscribe to the platform. Below is the code to simplify all the different values entered, for easier understanding of the variable.
```{r}
# Code used to replace all the values that are related to the contest tool at Wishpond.
wp_data$interest <- gsub(".*coupon.*|.*photo.*|.*instagram*|.*referral.*|.*sweepstake.*|.*text.*|.*video.*|.*vote.*|.*pinterest.*", "Contest", wp_data$interest)

# Code used to replace all the values that are related to the pop-up tool
wp_data$interest <- gsub(".*forms.*|.*action*|.*pop.*", "Pop-Up", wp_data$interest)

# Code used to replace all the values that are related to the Landing Page tool
wp_data$interest <- gsub(".*landing.*", "Landing Page", wp_data$interest)

```

	
	In order to evaluate the total amount of live tools by each customer, live pop-ups, live workflow, live contests and live landing pages was combined into a unique variable total live tools.

```{r}
# Sum of all the live tools on Wishpond to total_live_tools
wp_data <- wp_data %>%  mutate(total_live_tools =  live_popups + live_workflows + live_landings + live_contests)
```


	There was too much differentiation on the amount of leads and amount of total live tools by each customer, making it harder to analyze the most frequent level for these two variable. Therefore, we decided to categorize into fewer levels based on a range of leads captured and total live tools.



  Business industry variable had too much differentiation and only a few industries had frequent values. Therefore, in order to evaluate the most frequent business industries it was used the group_by function to group the top 15 industries and then rename the other industries to “Other”

```{r}
# Discovering the top 15 business industries
# group by video ---> https://www.youtube.com/watch?v=jWjqLW-u3hc --> 24min
biz_grouped <- wp_data %>% group_by(business_industry) 
top_biz <- biz_grouped %>% count(business_industry) %>% arrange(desc(n))
top_15_biz <- head(top_biz, 15)

# Filtering the top 15 industries
top_biz_db <- wp_data %>% group_by(business_industry) %>% filter(n() >= 131, business_industry != "Unknown")
top_biz_col <- wp_data %>% group_by(business_industry) %>% filter(n() >= 131, business_industry != "Unknown") %>% select(pid, business_industry)

# Renaming businesses industry that are not part of the top 15
other_biz_col <- wp_data %>% group_by(business_industry) %>% filter(n() < 131, business_industry != "Unknown") %>% select(pid, business_industry)
other_biz_col$business_industry <-  "Other"
biz_unknown <- wp_data %>% filter(business_industry == "Unknown") %>% select(pid, business_industry)
biz_unknown$business_industry <- as.character(biz_unknown$business_industry)
top_biz_col$business_industry <- as.character(top_biz_col$business_industry)
other_biz_col$business_industry <- as.character(other_biz_col$business_industry)
all_biz <- bind_rows(top_biz_col, other_biz_col, biz_unknown)
wp_data$business_industry <- all_biz$business_industry
```

#### Fourth Part

	Lastly, some variables were renamed and rearranged for better visualization of the database.

```{r}
#Renaming column name
wp_data <- wp_data %>% rename( read_blog = has_seen_the_blog_overlay)
wp_data <- wp_data %>% rename( language = locale)
wp_data <- wp_data %>% rename( support_agent = support_agent_name)
wp_data <- wp_data %>% rename( cancel_contact_support = current_cancel_contact_support)
wp_data <- wp_data %>% rename( cancel_feeling = current_cancel_feeling)

#Rearranging the Data-base
wp_data <- wp_data %>% select(pid, business_industry, business_size, selected_service, live_workflows, live_popups, total_live_tools, live_contests, live_landings, total_leads, interest, read_blog, sales_agent, sales, affiliated, plan_name, website, support_agent, cancel_contact_support, cancel_feeling, Unsubscribed)
```

### Data Exploration

  In order to identify which data might be useful in predicting the main factors for someone to upgrade their account on Wishpond, exploratory analysis was performed to compare the different variables to the customers’ plan.

#####	All Wishpond Subscribers
  The graph below show us what the most popular plans at Wishpond are. The interesting thing here is that most of the customers are on the Starter plan, which means that they have not paid Wishpond yet. Even though starter plan does not contain much data, it shows a great opportunity for Wishpond to grow. If we understand what it takes customers to use Wishpond, we might be able to get people from the Starter plan to sign-up with Wishpond.

```{r}
wp_data_subscribed_all <- wp_data %>%  filter(Unsubscribed == "FALSE")
ggplot(wp_data_subscribed_all, aes(plan_name)) +
  geom_bar(stat = "count", aes(fill = plan_name)) +
  xlab("Plan Name") +
  ylab("") +
  scale_fill_discrete(name = "Plan Name") 
```

#####	Paying Subscribers
  Next we will focus on paying customers only. Thus, we will filter out all the “Unknown” and “Starters” values from plan name variable.

```{r }
wp_data_subscribed <- wp_data %>% filter(Unsubscribed == "FALSE", plan_name != "Unknown", plan_name != "Starter")
```

#####	Total Amount of Leads
  For this graph, we start with those who have acquired at least one lead, as if we count those who haven’t captured any lead, it will distort the graph as the number is much greater than any other. This is not the best signal as it means that there are lot of customers that are not being able to generate any lead.
  Another interesting point to analyze is that there are a lot of customers on the basic plan that have acquired more leads than the maximum allowed under their current plan (500 leads), which means that they upgraded their account to run a campaign and then went back to basic plan. 

```{r}
ggplot(wp_data_subscribed, aes(total_leads, fill = plan_name)) +
  geom_histogram(breaks = seq(1,20000, by = 100))  +
  labs(x = "Total Leads", y = "Count") +
  scale_fill_discrete(name = "Plan Name") 
```

#####	Total Amount of Live Tools
  For this graph, we start with those who have created at least 1 tool, because if we count those who haven’t created anything, it will distort the graph as the number of zero live tool is much greater than any other.
  Another interesting point to analyze is that most of those who have more than 25 live tools are on the Pro and Growth plan. 


```{r}
ggplot(wp_data_subscribed, aes(total_live_tools, fill = plan_name)) +
  geom_histogram(breaks = seq(1,150, by = 5)) +
  labs(x = "Total Live Tools", y = "Count") +
  scale_fill_discrete(name = "Plan Name")  
```

#####	Sales
  The graph shows that most of the subscriptions are not coming through sales agents, but through other means. The sales team is fairly expensive with a lot of personnel. Thus, Wishpond could reduce expenses by decreasing the sales team and increase revenue by focusing on the different avenues that are bringing more customers.

```{r}
ggplot(wp_data_subscribed, aes(factor(wp_data_subscribed$plan_name))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_subscribed$plan_name))) +
  facet_grid(. ~ factor(wp_data_subscribed$sales)) +
  xlab("Plan Name") +
  scale_fill_discrete(name = "Plan Name")     
```

#####	Affiliated
  While affiliated links have not generated as many sales as sales agents, the number are not too far off. Also, the amount of money spent on an affiliated link is much less than a sales agent salary. Pushing the affiliated program could be a good alternative to bring more customers to Wishpond at a lower cost.

```{r}
ggplot(wp_data_subscribed, aes(factor(wp_data_subscribed$plan_name))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_subscribed$plan_name))) +
  facet_grid(. ~ factor(wp_data_subscribed$affiliated)) +
  xlab("Plan Name") +
  ylab("") +
  scale_fill_discrete(name = "Plan Name")     
```

#####	Have Read Wishpond Blog
  The graph below shows us that those who have read the blog are generating more leads than those who have not read the blog. Thus, showing us that the blog might help customers to capture leads.

```{r}
ggplot(wp_data_subscribed, aes(total_leads, fill = plan_name)) +
  geom_histogram(breaks = seq(1,20000, by = 100))  +
  facet_grid(. ~ factor(wp_data_subscribed$read_blog)) +
  labs(title = "Have Read The Blog?", x = "Total Leads", y = "Count") +
  scale_fill_discrete(name = "Plan Name")
```

#####	Have Read Wishpond Blog and Total Amount of Leads
  The graph below shows us that those who have read the blog create more tools than those who have not. Thus, showing that the blog might influence on supporting customer to get started with Wishpond and create different tools on the platform. 

```{r}
ggplot(wp_data_subscribed, aes(total_live_tools, fill = plan_name)) +
  geom_histogram(breaks = seq(1,150, by = 5)) +
  facet_grid(. ~ factor(wp_data_subscribed$read_blog)) +
  labs(title = "Have Read The Blog?", x = "Total Live Tools", y = "Count") +
  scale_fill_discrete(name = "Plan Name")  
```

#####	Have Read Wishpond Blog and Total Amount of Leads
  Similar to the amount of leads, we want to see how the blog is influencing customers on creating different tools at Wishpond. The interesting factor on this graph is that most of the customers that have read the blog are not using Wishpond tools as much as those who have not read it. Therefore, Wishpond should allocate some space to talk about the importance of using workflows, pop-up and other tools, in order to get customers to use more of Wishpond tools.

```{r}
ggplot(wp_data_subscribed, aes(factor(wp_data_subscribed$total_live_tools))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_subscribed$total_live_tools))) +
  facet_grid(. ~ factor(wp_data_subscribed$read_blog)) +
  xlab("Total Live Tools") +
  ylab("") +
  scale_fill_discrete(name = "Total Live Tools")
```

#####	Business Industry At Each Plan
  From the graph below we can see that e-commerce is the leading business industry on Wishpond, while agency has a good share of customers. By analysing the graph for the starter plan, we can understand where most of the opportunity to turn customers to paid customers are, e-commerce and agency. At the Growth plan, the most expensive plan, e-commerce is by far the most predominant business industry. Thus, it allows us to see where Wishpond should start focusing in order to bring more customers.

###### Starter Plan & Business Industry
```{r}
wp_data_starter <- wp_data %>% filter(plan_name == "Starter", Unsubscribed == "FALSE", business_industry != "Other", business_industry != "Unknown")
ggplot(wp_data_starter, aes(factor(wp_data_starter$business_industry))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_starter$business_industry))) +
  facet_grid(. ~ factor(wp_data_starter$plan_name)) +
  xlab("business industry") +
  ylab("") +
  scale_fill_discrete(name = "business industry")     
```

###### Basic Plan & Business Industry 
```{r}
wp_data_basic <- wp_data %>% filter(plan_name == "Basic", Unsubscribed == "FALSE", business_industry != "Other", business_industry != "Unknown")
ggplot(wp_data_basic, aes(factor(wp_data_basic$business_industry))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_basic$business_industry))) +
  facet_grid(. ~ factor(wp_data_basic$plan_name)) +
  xlab("business industry") +
  ylab("") +
  scale_fill_discrete(name = "business industry")    
```

###### Pro Plan & Business Industry | Second Most Expensive Plan | E-Commerce by far the most relevant one. Art-design and fitness health industry coming in second
```{r}
wp_data_pro <- wp_data %>% filter(plan_name == "Pro", Unsubscribed == "FALSE", business_industry != "Other", business_industry != "Unknown")
ggplot(wp_data_pro, aes(factor(wp_data_pro$business_industry))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_pro$business_industry))) +
  facet_grid(. ~ factor(wp_data_pro$plan_name)) +
  xlab("business industry") +
  ylab("") +
  scale_fill_discrete(name = "business industry")     
```

###### Growth Plan & Business | Most Expensive Plan  | E-Commerce by far again bringing the most customers to Growth plan.
```{r}
wp_data_growth <- wp_data %>% filter(plan_name == "Growth Plan", Unsubscribed == "FALSE", business_industry != "Other", business_industry != "Unknown")
ggplot(wp_data_growth, aes(factor(wp_data_growth$business_industry))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_growth$business_industry))) +
  facet_grid(. ~ factor(wp_data_growth$plan_name)) +
  xlab("business industry") +
  ylab("") +
  scale_fill_discrete(name = "business industry")     
```

#####	Business Industry and Unsubscribed
  The graph below shows us that e-commerce and agency are the business industries with the most cancels, similar to the highest amount of customers. However, by knowing that these are the greatest numbers of cancel, we can learn what keep customers from these business industries subscribeed at Wishpond and eventually decrease the number of cancels.

```{r}
wp_data_unsubscribed <- wp_data %>% filter(Unsubscribed == "TRUE", business_industry != "Other", business_industry != "Unknown")
ggplot(wp_data_unsubscribed, aes(factor(wp_data_unsubscribed$business_industry))) +
  geom_bar(stat = "count", aes(fill = factor(wp_data_unsubscribed$business_industry))) +
  xlab("Business Industry") +
  ylab("") +
  scale_fill_discrete(name = "Business Industry")        
```
